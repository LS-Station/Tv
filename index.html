<!DOCTYPE html>
<html lang="bn">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>M3U চ্যানেল টেস্টার প্লেয়ার</title>
    <script src="https://cdn.jsdelivr.net/npm/hls.js@1.5.15"></script>
    <style>
        /* আপনার জন্য ডিজাইন করা স্টাইল */
        body { font-family: 'Arial', sans-serif; background: #1a1a2e; color: #e0e0ff; padding: 20px; }
        .container { max-width: 900px; margin: 0 auto; background: #2c2c54; padding: 25px; border-radius: 12px; box-shadow: 0 4px 15px rgba(0, 0, 0, 0.4); }
        h1 { color: #00d4ff; text-align: center; margin-bottom: 20px; font-size: 1.8rem; }
        .input-group { display: flex; gap: 10px; margin-bottom: 20px; }
        #streamInput { flex-grow: 1; padding: 12px; border-radius: 8px; border: 1px solid #4a4a7d; background: #1a1a2e; color: #e0e0ff; font-size: 1rem; }
        #loadButton { padding: 12px 25px; background: #4caf50; color: white; border: none; border-radius: 8px; cursor: pointer; font-size: 1rem; font-weight: bold; transition: background 0.2s; }
        #loadButton:hover { background: #45a049; }
        .video-container { width: 100%; aspect-ratio: 16/9; background: #000; border-radius: 8px; margin-bottom: 15px; }
        #videoPlayer { width: 100%; height: 100%; border-radius: 8px; }
        #statusMessage { padding: 10px; border-radius: 8px; text-align: center; font-weight: bold; }
        .status-loading { background: #ffc107; color: #333; }
        .status-success { background: #4caf50; color: white; }
        .status-error { background: #f44336; color: white; }
    </style>
</head>
<body>
    <div class="container">
        <h1>M3U চ্যানেল টেস্টার প্লেয়ার</h1>
        <p style="margin-bottom: 15px; color: #aaaaaa;">আপনি যে চ্যানেলের লিংক (M3U8/HLS) পরীক্ষা করতে চান, সেটি নিচে দিন এবং "স্ট্রীম লোড করুন" বাটনে ক্লিক করুন।</p>
        
        <div class="input-group">
            <input type="text" id="streamInput" placeholder="চ্যানেল স্ট্রীম URL এখানে পেস্ট করুন (যেমন: http://example.com/live/stream.m3u8)">
            <button id="loadButton" onclick="loadStream()">স্ট্রীম লোড করুন</button>
        </div>
        
        <div class="video-container">
            <video id="videoPlayer" controls autoplay playsinline></video>
        </div>
        
        <div id="statusMessage" class="status-loading">স্ট্যাটাস: পরীক্ষার জন্য লিংক দিন</div>
    </div>

    <script>
        // নির্ভরযোগ্য CORS বাইপাসের জন্য একটি প্রক্সি URL
        // এটি আপনার ব্রাউজারের CORS নীতি এড়িয়ে লিংক লোড করতে সাহায্য করবে।
        const PROXY_URL = 'https://api.allorigins.win/raw?url='; 
        let currentHls = null;

        // স্ট্যাটাস বার আপডেট করার ফাংশন
        function updateStatus(message, type) {
            const statusElement = document.getElementById('statusMessage');
            statusElement.textContent = `স্ট্যাটাস: ${message}`;
            statusElement.className = ''; 
            statusElement.classList.add('status-' + type);
        }

        function loadStream() {
            const rawUrl = document.getElementById('streamInput').value.trim();
            const video = document.getElementById('videoPlayer');

            if (!rawUrl) {
                updateStatus('লিংকটি খালি রাখা যাবে না!', 'error');
                return;
            }
            
            // পূর্বের কোনো স্ট্রীম চললে তা বন্ধ করা হচ্ছে
            if (currentHls) {
                currentHls.destroy();
                currentHls = null;
            }
            
            // CORS বাইপাসের জন্য মূল লিংকের সাথে প্রক্সি URL যুক্ত করা হলো
            const proxyUrl = PROXY_URL + encodeURIComponent(rawUrl);

            updateStatus('লোড হচ্ছে... (প্রক্সি ব্যবহার করা হচ্ছে)', 'loading');
            video.pause();
            video.removeAttribute('src'); 

            if (Hls.isSupported()) {
                currentHls = new Hls();
                
                // HLS সোর্স লোড করার চেষ্টা
                currentHls.loadSource(proxyUrl);
                currentHls.attachMedia(video);

                currentHls.on(Hls.Events.MANIFEST_PARSED, () => {
                    updateStatus('✅ স্ট্রীম সফলভাবে লোড হয়েছে! লিংকটি সচল।', 'success');
                    video.play().catch(e => {
                        console.error("Autoplay failed:", e);
                        updateStatus('❌ অটো-প্লে ব্যর্থ হয়েছে। ম্যানুয়ালি প্লে করুন।', 'error');
                    });
                });

                currentHls.on(Hls.Events.ERROR, (event, data) => {
                    if (data.fatal) {
                        currentHls.destroy();
                        let errorMessage = '❌ স্ট্রীম লোড করতে ব্যর্থ। লিংকটি কাজ করছে না অথবা VPN/অন্য প্রক্সি লাগবে।';
                        if (data.details.includes('networkError')) {
                             errorMessage = '❌ নেটওয়ার্ক ত্রুটি। লিংকটি ব্লকড অথবা সার্ভার অফলাইন।';
                        }
                        updateStatus(errorMessage, 'error');
                        console.error("Fatal HLS Error:", data);
                    }
                });
            } else {
                // HLS.js সমর্থিত না হলে সাধারণ ভিডিও লোড করার চেষ্টা
                video.src = proxyUrl;
                video.play();
                updateStatus('⚠️ HLS.js নেই, সাধারণ প্লেব্যাক ব্যবহার করা হচ্ছে।', 'error');
            }
        }
    </script>
</body>
</html>
